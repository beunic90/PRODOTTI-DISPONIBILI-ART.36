<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listino Prezzi Dinamico</title>
    <style>
        /* CSS per lo Stile */
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f9; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        #searchBar, .whatsapp-button { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .whatsapp-button { background-color: #25D366; color: white; border: none; font-size: 16px; cursor: pointer; transition: background-color 0.3s; }
        .whatsapp-button:hover { background-color: #128C7E; }
        .product-list { margin-top: 20px; }
        .product-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .product-item:last-child { border-bottom: none; }
        .product-item input[type="checkbox"] { transform: scale(1.5); margin-right: 15px; cursor: pointer; }
        .product-details { flex-grow: 1; }
        .product-name { font-weight: bold; }
        .product-price { color: #007bff; font-weight: bold; width: 100px; text-align: right; }
        .selection-summary { margin-top: 20px; padding: 15px; border: 1px solid #ffc107; background-color: #fff9e6; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Listino Prezzi - Ricerca Prodotti</h1>

    <input type="text" id="searchBar" onkeyup="filterProducts()" placeholder="Digita per cercare prodotti, modelli o brand...">

    <div id="productList" class="product-list">
        </div>

    <div class="selection-summary">
        Prodotti Selezionati: <span id="selectedCount">0</span>
    </div>

    <button id="whatsappReqBtn" class="whatsapp-button" onclick="sendWhatsappRequest()">
        Invia Richiesta via WhatsApp (366 529 2581)
    </button>
</div>

<script>
    // Incolla il contenuto del tuo CSV qui come una singola stringa.
    // Ho incluso qui una versione formattata dal tuo file per comodità.
    const csvData = `
DESCRIZIONE,PREZZO VENDITA
Apple iPhone 12 Mini 128GB Blue "IVA Art.36 ",235
Acer Aspire E 15 Start ES1-512-C08J Processore: Intel Celeron N2840 (fino a 2,58 GHz) RAM: 4 GB Archiviazione: 500 GB HDD Display: 15,6" HD (1366x768) Scheda Grafica: Intel HD Graphics Sistema Operativo: Windows 8.1 Connettività: Wi-Fi 802.11n, Bluetooth 4.0, Gigabit Ethernet Porte: 1x USB 3.0, 2x USB 2.0, Lettore SD Peso: 2,4 kg *batteria da sostituire, disco e RAM consigliato upgrade . privo di cavo di alimentazione.,25
Alcatel Pixi 4 4" 4034x 4gb Black,3
Apple iPhone 11 128gb Black A2223 Sales Model MHEV3 CH/A *scocca rotta e piegata+ schermo rotto*batteria da sostituire- presentava un crash report e aveva spegnimenti/riavvii random, è stato riscontrato come colpevole la memoria principale NAND*,29
Apple iPhone 11 64gb Space Gray **Manomesso/già riparato lo schermo in passato più volte, scocca e batteria da sostituire, presente spotcam camera posteriore,49
Apple iPhone ... x Ricambi *SCOCCA DANNEGGIATA E SCHERMO NON FUNZIONANTE, BATTERIA DA SOSTITUIRE, ACCENDE MA NON VISUALIZZA, SCHEDA MADRE NON UTILIZZABILE FRP,15
Parti di ricambio iPhone 11 Pro Max Gold (SCOCCA COMPLETA ORIGINALE+SCHERMO COMPRATIBILE PRIVO DI FLEX),65
REDMI NOTE 5 64GB 4GB BLACK M1803E7SG *SCHERMO COMPROMESSO DA VETRO ROTTO,9
REDMI Note 8 M1908C3JG Space Black x Ricambi * SCOCCA, CARRELLINO SIM E SCHERMO DANNEGGIATI, SCHERMO FUNZIONA MA SCHEDA MADRE NON UTILIZZABILE FRP,15
Samsung A50 A505FN/DS 128gb White *Riavvio continuo*,35
Samsung Galaxy 8+ 64GB G955F Silver *fronte e retro danneggiati , visualizza,25
Samsung Galaxy A56 5g 8/128gb Awesome Graphite,259
Samsung Galaxy A7 SM-A750F BLACK ITV **vetro rotto+ backglass scollato batteria non tiene+leggermente piegato**,12
Samsung Galaxy Music S6010 GT-S6010 4gb 512mb White,8
Samsung Galaxy S Advance GT-I9070 ITV 4GB WHITE **VETRO GRAFFIATO E SCOCCA SCOLORITA SEGNATA**,6
    `;

    let products = [];

    document.addEventListener('DOMContentLoaded', () => {
        parseCSV(csvData);
        sortProducts();
        renderProducts(products);
    });

    // Funzione per analizzare i dati CSV
    function parseCSV(data) {
        const lines = data.trim().split('\n');
        // Ignora l'header
        for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line) {
                // Utilizzo di una regex per gestire i valori separati da virgola,
                // ma che potrebbero contenere virgole all'interno di virgolette (")
                const values = line.match(/(?:[^\,"]|"(?:\\.|[^"])*")*/g).slice(0, 2);
                
                if (values && values[0] && values[1]) {
                    // Rimuove spazi, virgolette iniziali/finali e caratteri speciali
                    const description = values[0].trim().replace(/^"|"$/g, '').replace(/(\r\n|\n|\r)/gm," ");
                    const price = parseFloat(values[1].replace(/[^0-9\.]/g, '')) || 0; // Pulisce e converte il prezzo
                    
                    products.push({
                        id: i, // ID univoco per il checkbox
                        name: description,
                        price: price,
                        brand: description.split(' ')[0].toUpperCase() // Prende la prima parola come Brand
                    });
                }
            }
        }
    }

    // Funzione per ordinare i prodotti (Apple prima, poi gli altri)
    function sortProducts() {
        products.sort((a, b) => {
            // Se entrambi sono Apple o nessuno dei due è Apple, ordina alfabeticamente per nome
            if ((a.brand === 'APPLE' && b.brand === 'APPLE') || (a.brand !== 'APPLE' && b.brand !== 'APPLE')) {
                return a.name.localeCompare(b.name);
            }
            // Metti Apple prima di tutto il resto
            if (a.brand === 'APPLE') return -1;
            if (b.brand === 'APPLE') return 1;
            return 0; // Non dovrebbe succedere
        });
    }

    // Funzione per renderizzare i prodotti nell'HTML
    function renderProducts(items) {
        const listContainer = document.getElementById('productList');
        listContainer.innerHTML = ''; // Pulisce la lista

        items.forEach(product => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'product-item';
            itemDiv.innerHTML = `
                <input type="checkbox" data-id="${product.id}" onchange="updateSelectionSummary()">
                <div class="product-details">
                    <span class="product-name">${product.name}</span>
                </div>
                <div class="product-price">€ ${product.price.toFixed(2)}</div>
            `;
            listContainer.appendChild(itemDiv);
        });
        updateSelectionSummary(); // Aggiorna il conteggio iniziale
    }

    // Funzione per filtrare i prodotti in base all'input dell'utente
    function filterProducts() {
        const searchText = document.getElementById('searchBar').value.toLowerCase();
        
        const filteredProducts = products.filter(product => {
            return product.name.toLowerCase().includes(searchText);
        });
        
        renderProducts(filteredProducts);
    }

    // Funzione per aggiornare il conteggio dei prodotti selezionati
    function updateSelectionSummary() {
        const selectedCheckboxes = document.querySelectorAll('#productList input[type="checkbox"]:checked');
        document.getElementById('selectedCount').textContent = selectedCheckboxes.length;
    }

    // Funzione per costruire il messaggio WhatsApp
    function sendWhatsappRequest() {
        const selectedCheckboxes = document.querySelectorAll('#productList input[type="checkbox"]:checked');
        
        if (selectedCheckboxes.length === 0) {
            alert("Seleziona almeno un prodotto prima di inviare la richiesta.");
            return;
        }

        let messageText = "Ciao, vorrei richiedere informazioni e disponibilità sui seguenti articoli:\n\n";
        
        selectedCheckboxes.forEach(checkbox => {
            const productId = parseInt(checkbox.dataset.id);
            const product = products.find(p => p.id === productId);
            if (product) {
                // Rimuove il prezzo dal messaggio WhatsApp, poiché si richiede disponibilità.
                messageText += `- ${product.name}\n`; 
            }
        });

        messageText += "\nGrazie!";

        const phoneNumber = '3665292581';
        // Codifica il messaggio per l'URL
        const encodedMessage = encodeURIComponent(messageText);

        // Costruisce il link WhatsApp
        const whatsappLink = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;

        // Apre il link in una nuova scheda
        window.open(whatsappLink, '_blank');
    }
</script>

</body>
</html>